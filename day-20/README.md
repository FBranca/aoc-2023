This solution should be refactored, too complex for what it does.